from django.shortcuts import render, redirect, get_object_or_404, Http404
from django.http import HttpResponse
from .forms import TargetForm
from .models import Target, Report

def submit_target(request):
    if request.method == 'POST':
        form = TargetForm(request.POST)
        if form.is_valid():
            # print(form.cleaned_data)
            target = Target.objects.create(**form.cleaned_data)
            return redirect(target)
    else:
        form = TargetForm()
    return render(request, 'Pentestor/add_target.html', {'form': form})

def view_target(request, target_id: int):
    target = get_object_or_404(Target, pk=target_id)
    reports = Report.objects.filter(target_id=target_id)
    return render(request, 'Pentestor/view_target.html', {"item": target, "reports": reports})

def view_targets(request):
    return render(request, 'Pentestor/list_targets.html', {"targets": Target.objects.all()})

def pageNotFound(request, page: str):
    raise Http404(f"Page {page} not found!")
